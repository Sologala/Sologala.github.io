<!DOCTYPE html>
<html>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultralytics YOLOv8 - DawsonWen的个人网站</title>
    <meta name="author"  content="DawsonWen">
    <meta name="description" content="Ultralytics YOLOv8">
    <meta name="keywords"  content="论文阅读">
    <!-- Open Graph -->
    <meta property="og:title" content="Ultralytics YOLOv8 - DawsonWen的个人网站">
    <meta property="og:type" content="website">
    <meta property="og:url" content="http://localhost:4000/2023/01/31/yolov8.html">
    <meta property="og:description" content="为天地立心, 为生民立命, 为往圣继绝学, 为万世开太平">
    <meta property="og:site_name" content="DawsonWen的个人网站">
    <link rel="stylesheet" href="//cdn.staticfile.org/normalize/6.0.0/normalize.min.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_roc50gemkxpw4s4i.css">
    <link rel="stylesheet" href="/assets/css/github-markdown.css">
    <link rel="stylesheet" href="/assets/css/prism.css">
    <link rel="stylesheet" href="/assets/css/share.min.css">
    <link rel="stylesheet" href="/assets/css/app.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
	
	<!--
Author: Ray-Eldath
refer to:
 - http://docs.mathjax.org/en/latest/options/index.html
-->

	<script type="text/javascript" async src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
	
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
		jax: ["input/TeX", "output/HTML-CSS"],
		tex2jax: {
			inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
			displayMath: [ ["$$", "$$"], ["\\[","\\]"] ],
			skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
		},
		"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
      });
    </script>


	
    <!--
Author: Ray-Eldath
-->
<style>
    .markdown-body .anchor{
        float: left;
        margin-top: -8px;
        margin-left: -20px;
        padding-right: 4px;
        line-height: 1;
        opacity: 0;
    }
    
    .markdown-body .anchor .anchor-icon{
        font-size: 15px
    }
</style>
<script>
    $(document).ready(function() {
        let nodes = document.querySelector(".markdown-body").querySelectorAll("h1,h2,h3")
        for(let node of nodes) {
            var anchor = document.createElement("a")
            var anchorIcon = document.createElement("i")
            anchorIcon.setAttribute("class", "fa fa-anchor fa-lg anchor-icon")
            anchorIcon.setAttribute("aria-hidden", true)
            anchor.setAttribute("class", "anchor")
            anchor.setAttribute("href", "#" + node.getAttribute("id"))
            
            anchor.onmouseover = function() {
                this.style.opacity = "0.4"
            }
            
            anchor.onmouseout = function() {
                this.style.opacity = "0"
            }
            
            anchor.appendChild(anchorIcon)
            node.appendChild(anchor)
        }
    })
</script>
	
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?671e6ffb306c963dfa227c8335045b4f";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
		
        })();
    </script>

</head>


<body>
  <!--[if lt IE 10]>
<div class="alert-danger" role="alert">你的浏览器实在太太太旧了，放学别走，升级完浏览器再说！<a target="_blank" class="alert-link" href="http://browsehappy.com">立即升级</a></div>
<![endif]-->
  <input id="nm-switch" type="hidden" value="true"> <header class="g-header">
    <div class="g-logo">
      <a href="/"></a>
    </div>
    <i id="menu-toggle" class="iconfont icon-menu"></i>
    <nav class="g-nav">
        <ul>
            
            <li><a href="/">home</a></li>
            
            <li><a href="/tags.html">tags</a></li>
            
        </ul>
    </nav>
</header>


  <header
    class="g-banner post-header post-pattern-circuitBoard bgcolor-default "
    data-theme="default"
  >
    <div class="post-wrapper">
      <div class="post-tags">
        
          
            <a href="/tags.html#%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB" class="post-tag">论文阅读</a>
          
        
      </div>
      <h1>Ultralytics YOLOv8</h1>
      <div class="post-meta">
        <span class="post-meta-item"><i class="iconfont icon-author"></i>郑之杰</span>
        <time class="post-meta-item" datetime="23-01-31"><i class="iconfont icon-date"></i>31 Jan 2023</time>
      </div>
    </div>
    
    <div class="filter"></div>
      <div class="post-cover" style="background: url('https://pic.imgdb.cn/item/65332ac8c458853aef693b48.jpg') center no-repeat; background-size: cover;"></div>
    
  </header>

  <div class="post-content visible">
    

    <article class="markdown-body">
      <blockquote>
  <p>Ultralytics YOLOv8：实时目标检测和图像分割模型的最新版本.</p>
</blockquote>

<ul>
  <li>paper：<a href="https://github.com/ultralytics/ultralytics">Ultralytics YOLOv8</a></li>
</ul>

<p><strong>YOLOv8</strong> 是 <strong>Ultralytics</strong> 公司开源的 <a href="https://0809zheng.github.io/2022/07/09/yolov5.html"><font color="blue">YOLOv5</font></a> 的下一个重大更新版本，目前支持图像分类、物体检测和实例分割任务。<strong>YOLOv8</strong> 在以前 <strong>YOLO</strong> 版本的成功基础上并引入了新的功能和改进，具体创新包括一个新的骨干网络、一个新的 <strong>Ancher-Free</strong> 检测头和一个新的损失函数，可以在从 <strong>CPU</strong> 到 <strong>GPU</strong> 的各种硬件平台上运行。</p>

<p><strong>YOLOv8</strong> 相比 <strong>YOLOv5</strong> 精度提升非常多，但是 <strong>N/S/M</strong> 模型相应的参数量和 <strong>FLOPs</strong> 都增加了不少，相比 <strong>YOLOV5</strong> 大部分模型推理速度变慢了。</p>

<p><img src="https://pic.imgdb.cn/item/65332bc4c458853aef6c0710.jpg" alt="" /></p>

<p><strong>YOLOv8</strong> 算法的核心特性和改动可以归结为如下：</p>
<ul>
  <li>提供了一个全新的 <strong>SOTA</strong> 模型，包括 <strong>P5 640</strong> 和 <strong>P6 1280</strong> 分辨率的目标检测网络和基于 <strong>YOLACT</strong> 的实例分割模型。和 <strong>YOLOv5</strong> 一样，基于缩放系数也提供了 <strong>N/S/M/L/X</strong> 尺度的不同大小模型，用于满足不同场景需求</li>
  <li>骨干网络和 <strong>Neck</strong> 部分可能参考了 <strong>YOLOv7 ELAN</strong> 设计思想，将 <strong>YOLOv5</strong> 的 <strong>C3</strong> 结构换成了梯度流更丰富的 <strong>C2f</strong> 结构，并对不同尺度模型调整了不同的通道数，属于对模型结构精心微调，不再是无脑一套参数应用所有模型，大幅提升了模型性能。不过这个 <strong>C2f</strong> 模块中存在 <strong>Split</strong> 等操作对特定硬件部署没有之前那么友好了</li>
  <li><strong>Head</strong> 部分相比 <strong>YOLOv5</strong> 改动较大，换成了目前主流的解耦头结构，将分类和检测头分离，同时也从 <strong>Anchor-Based</strong> 换成了 <strong>Anchor-Free</strong></li>
  <li><strong>Loss</strong> 计算方面采用了 <strong>TaskAlignedAssigner</strong> 正样本分配策略，并引入了 <strong>Distribution Focal Loss</strong></li>
  <li>训练的数据增强部分引入了 <strong>YOLOX</strong> 中的最后 <strong>10 epoch</strong> 关闭 <strong>Mosiac</strong> 增强的操作，可以有效地提升精度</li>
</ul>

<h2 id="1-模型结构设计">1. 模型结构设计</h2>

<p><img src="https://pic.imgdb.cn/item/65332ae6c458853aef6995f5.jpg" alt="" /></p>

<p><strong>YOLOv8</strong> 相比 <strong>YOLOv5</strong> 在骨干网络和 <strong>Neck</strong> 的具体变化为：</p>
<ul>
  <li>第一个卷积层的 <strong>kernel</strong> 从 <strong>6x6</strong> 变成了 <strong>3x3</strong></li>
  <li>所有的 <strong>C3</strong> 模块换成 <strong>C2f</strong>，多了更多的跳层连接和额外的 <strong>Split</strong> 操作</li>
  <li>去掉了 <strong>Neck</strong> 模块中的 <strong>2</strong> 个卷积连接层</li>
  <li><strong>Backbone</strong> 中 <strong>C2f</strong> 的 <strong>block</strong> 数从 <strong>3-6-9-3</strong> 改成了 <strong>3-6-6-3</strong></li>
  <li><strong>N/S</strong> 和 <strong>L/X</strong> 两组模型只是改了缩放系数，但是 <strong>S/M/L</strong> 等骨干网络的通道数设置不一样，没有遵循同一套缩放系数</li>
</ul>

<p><strong>Head</strong> 部分从原先的耦合头变成了解耦头，不再有之前的 <strong>objectness</strong> 分支，只有解耦的分类和回归分支，并且其回归分支使用了 <strong>Distribution Focal Loss</strong> 中提出的积分形式表示法。并且从 <strong>YOLOv5</strong> 的 <strong>Anchor-Based</strong> 变成了 <strong>Anchor-Free</strong>：</p>

<p><img src="https://pic.imgdb.cn/item/65332ea2c458853aef747d86.jpg" alt="" /></p>

<h2 id="2-损失函数计算">2. 损失函数计算</h2>

<p><strong>Loss</strong> 计算过程包括 <strong>2</strong> 个部分： 正负样本分配策略和 <strong>Loss</strong> 计算。</p>

<p>现代目标检测器大部分都会在正负样本分配策略上面做文章，考虑到动态分配策略的优异性，<strong>YOLOv8</strong> 算法直接引用了 <a href="https://0809zheng.github.io/2021/10/12/tood.html"><font color="blue">TOOD</font></a>。 <strong>TOOD</strong> 的匹配策略简单总结为： 根据分类与回归的分数加权的分数选择正样本。</p>

\[t=s^\alpha+u^\beta\]

<p>$s$ 是标注类别对应的预测分值，$u$ 是预测框和 <strong>gt</strong> 框的 <strong>iou</strong>，两者相乘就可以衡量对齐程度。</p>
<ol>
  <li>对于每一个 <strong>GT</strong>，对所有的预测框基于 <strong>GT</strong> 类别对应分类分数，预测框与 <strong>GT</strong> 的 <strong>IoU</strong> 的加权得到一个关联分类以及回归的对齐分数 <strong>alignment_metrics</strong></li>
  <li>对于每一个 <strong>GT</strong>，直接基于 <strong>alignment_metrics</strong> 对齐分数选取 <strong>topK</strong> 大的作为正样本</li>
</ol>

<p><strong>Loss</strong> 计算包括 <strong>2</strong> 个分支：</p>
<ol>
  <li>分类分支：采用 <strong>BCE Loss</strong></li>
  <li>回归分支：和 <strong>Distribution Focal Loss</strong> 中提出的积分形式表示法绑定，因此使用了 <strong>Distribution Focal Loss</strong>， 同时还使用了 <strong>CIoU Loss</strong></li>
</ol>

<h2 id="3-训练策略">3. 训练策略</h2>

<p>数据增强方面和 <strong>YOLOv5</strong> 差距不大，只不过引入了 <strong>YOLOX</strong> 中提出的最后 <strong>10</strong> 个 <strong>epoch</strong> 关闭 <strong>Mosaic</strong> 的操作。假设训练 <strong>epoch</strong> 是 <strong>500</strong>，其示意图如下所示：</p>

<p><img src="https://pic.imgdb.cn/item/653330b2c458853aef7ab8e7.jpg" alt="" /></p>

<p>考虑到不同模型应该采用的数据增强强度不一样，因此对于不同大小模型，有部分超参会进行修改，典型的如大模型会开启 <strong>MixUp</strong> 和 <strong>CopyPaste</strong>。</p>

<p><strong>YOLOv8</strong> 的训练策略和 <strong>YOLOv5</strong> 最大区别就是模型的训练总 <strong>epoch</strong> 数从 <strong>300</strong> 提升到了 <strong>500</strong>，这也导致训练时间急剧增加。以 <strong>YOLOv8-S</strong> 为例，其训练策略汇总如下：</p>

<p><img src="https://pic.imgdb.cn/item/653330fdc458853aef7ba1c2.jpg" alt="" /></p>

<h2 id="4-模型推理过程">4. 模型推理过程</h2>

<p><strong>YOLOv8</strong> 的推理过程和 <strong>YOLOv5</strong> 唯一差别在于前面需要对 <strong>Distribution Focal Loss</strong> 中的积分表示 <strong>bbox</strong> 形式进行解码，变成常规的 <strong>4</strong> 维度 <strong>bbox</strong>。</p>

<p>以 <strong>COCO 80</strong> 类为例，假设输入图片大小为 <strong>640x640</strong>，<strong>YOLOv8</strong> 中实现的推理过程示意图如下所示：</p>

<p><img src="https://pic.imgdb.cn/item/65333189c458853aef7d5611.jpg" alt="" /></p>

<ol>
  <li><strong>bbox</strong> 积分形式转换为 <strong>4d bbox</strong> 格式：对 <strong>Head</strong> 输出的 <strong>bbox</strong> 分支进行转换，利用 <strong>Softmax</strong> 和 <strong>Conv</strong> 计算将积分形式转换为 <strong>4</strong> 维 <strong>bbox</strong> 格式</li>
  <li>维度变换：<strong>YOLOv8</strong> 输出特征图尺度为 <strong>80x80</strong>、<strong>40x40</strong> 和 <strong>20x20</strong> 的三个特征图。<strong>Head</strong> 部分输出分类和回归共 <strong>6</strong> 个尺度的特征图。 将 <strong>3</strong> 个不同尺度的类别预测分支、<strong>bbox</strong> 预测分支进行拼接，并进行维度变换。为了后续方便处理，会将原先的通道维度置换到最后，类别预测分支 和 <strong>bbox</strong> 预测分支 <strong>shape</strong> 分别为 <strong>(b, 80x80+40x40+20x20, 80)=(b,8400,80)</strong>，<strong>(b,8400,4)</strong>。</li>
  <li>解码还原到原图尺度：分类预测分支进行 <strong>Sigmoid</strong> 计算，而 <strong>bbox</strong> 预测分支需要进行解码，还原为真实的原图解码后 <strong>xyxy</strong> 格式。</li>
  <li>阈值过滤：遍历 <strong>batch</strong> 中的每张图，采用 <strong>score_thr</strong> 进行阈值过滤。在这过程中还需要考虑 <strong>multi_label</strong> 和 <strong>nms_pre</strong>，确保过滤后的检测框数目不会多于 <strong>nms_pre</strong>。</li>
  <li>还原到原图尺度和 <strong>nms</strong>：基于前处理过程，将剩下的检测框还原到网络输出前的原图尺度，然后进行 <strong>nms</strong> 即可。最终输出的检测框不能多于 <strong>max_per_img</strong>。</li>
</ol>


    </article>

    
    <div class="social-share-wrapper">
      <div class="social-share"></div>
    </div>
    
  </div>

  <section class="author-detail">
    <section class="post-footer-item author-card">
      <div class="avatar">
        <img src="https://avatars.githubusercontent.com/u/46283762?v=4&size=64" alt="">
      </div>
      <div class="author-name" rel="author">DawsonWen</div>
      <div class="bio">
        <p></p>
      </div>
      
      <ul class="sns-links">
        
        <li>
          <a href="//github.com/Sologala" target="_blank">
                    <i class="iconfont icon-github"></i>
                </a>
        </li>
        
      </ul>
      
    </section>
    <section class="post-footer-item read-next">
      
      <div class="read-next-item">
        <a href="/2023/02/01/adapter.html" class="read-next-link"></a>
        <section>
          <span>Parameter-Efficient Transfer Learning for NLP</span>
          <p>  自然语言处理中的参数高效的迁移学习.</p>
        </section>
        
        <div class="filter"></div>
        <img src="https://pic.imgdb.cn/item/648d64d21ddac507ccaabefd.jpg" alt="">
        
     </div>
      

      
      <div class="read-next-item">
        <a href="/2023/01/25/refiner.html" class="read-next-link"></a>
          <section>
            <span>Refiner: Refining Self-attention for Vision Transformers</span>
            <p>  Refiner：精炼视觉Transformer中的自注意力机制.</p>
          </section>
          
          <div class="filter"></div>
          <img src="https://pic.imgdb.cn/item/643fbd7f0d2dde5777147f3c.jpg" alt="">
          
      </div>
      
    </section>
    
    <section class="post-footer-item comment">
      <div id="disqus_thread"></div>
      <div id="gitalk_container"></div>
    </section>
  </section>

  <!-- <footer class="g-footer">
  <script type='text/javascript' id='clustrmaps' src='//cdn.clustrmaps.com/map_v2.js?cl=ffffff&w=800&t=m&d=WWuzUTmOt8V9vdtIQd5uqrEcKsRg4IiPuy9gg21CQO8'></script>
  <section>DawsonWen的个人网站 ©
  
  
    2020
    -
  
  2024
  </section>
  <section>Powered by <a href="//jekyllrb.com">Jekyll</a></section>
</footer>
 -->

  <script src="/assets/js/social-share.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <script>
    socialShare('.social-share', {
      sites: [
        
          'wechat'
          ,
          
        
          'weibo'
          ,
          
        
          'douban'
          ,
          
        
          'twitter'
          
        
      ],
      wechatQrcodeTitle: "分享到微信朋友圈",
      wechatQrcodeHelper: '<p>扫码后点击右上角</p><p>将本文分享至朋友圈</p>'
    });
  </script>

  
	
  

  <script src="/assets/js/prism.js"></script>
  <script src="/assets/js/index.min.js"></script>
</body>

</html>
